1. Дана схема базы данных в виде следующих отношений. 
   С помощью операторов SQL создать логическую структуру соответствующих таблиц для хранения в СУБД, 
   используя известные средства поддержания целостности (NOT NULL, UNIQUE, и т.д.). 
   Обосновать выбор типов данных и используемые средства поддержания целостности. 
   При выборе подходящих типов данных использовать информацию о конкретных значениях полей БД (см. прил.1)

```sql
CREATE TABLE "ПОКУПАТЕЛЬ" (
    "ИДЕНТИФИКАТОР" integer NOT NULL GENERATED BY DEFAULT AS IDENTITY,
    -- Идентификатор integer, обязательно должен быть, не может быть NULL.
    -- В случае, если явно не указан - задается автоматически
    "ФАМИЛИЯ" varchar(100),
    -- 100 символов для фамилии будет точно достаточно
    "РАЙОН ПРОЖИВАНИЯ" varchar(100),
    -- 100 символов для названия района проживания будет точно достаточно
    "СКИДКА" smallint CHECK ("СКИДКА" <= 100 AND "СКИДКА" >= 0),
    -- Благодаря smallint тратится минимальное количество памяти,
    -- CHECK обязывает записывать в данное поле только значения от 0% до 100%
    PRIMARY KEY ("ИДЕНТИФИКАТОР")
    -- Первичный ключ
);

CREATE TABLE "МАГАЗИН" (
    "ИДЕНТИФИКАТОР" integer NOT NULL GENERATED BY DEFAULT AS IDENTITY,
    -- Идентификатор integer, обязательно должен быть, не может быть NULL.
    -- В случае, если явно не указано - задается автоматически
    "НАЗВАНИЕ" varchar(100),
    -- 100 символов для названия будет точно достаточно
    "РАЙОН РАЗМЕЩЕНИЯ" varchar(100),
    -- 100 символов для названия района размещения будет точно достаточно
    "КОМИССИОННЫЕ" smallint CHECK ("КОМИССИОННЫЕ" <= 100 AND "КОМИССИОННЫЕ" >= 0),
    -- Благодаря smallint тратится минимальное количество памяти,
    -- CHECK обязывает записывать в данное поле только значения от 0% до 100%
    PRIMARY KEY ("ИДЕНТИФИКАТОР")
    -- Первичный ключ
);

CREATE TABLE "КНИГИ" (
    "ИДЕНТИФИКАТОР" integer NOT NULL GENERATED BY DEFAULT AS IDENTITY,
    -- Идентификатор integer, обязательно должен быть, не может быть NULL.
    -- В случае, если явно не указан - задается автоматически
    "НАЗВАНИЕ" text NOT NULL,
    -- Вполне возможно, что у книги будет довольно длинное название, 
    -- поэтому лучше использовать text. У книги обязательно должно быть название,
    -- поэтому ограничение NOT NULL.
    "СТОИМОСТЬ" integer, 
    -- На всякий случай, используем integer, т.к. цена может быть очень высокой
    "СКЛАД" varchar(100),
    -- 100 символов для названия склада будет точно достаточно
    "КОЛ-ВО" integer,
    -- Количество продаваемых книг может быть довольно большим, 
    -- поэтому smallint может не хватить
    PRIMARY KEY ("ИДЕНТИФИКАТОР")
    -- Первичный ключ
);

CREATE TABLE "ПОКУПКА" (
    "НОМЕР ЗАКАЗА" integer NOT NULL GENERATED BY DEFAULT AS IDENTITY,
    -- Идентификатор integer, обязательно должен быть, не может быть NULL.
    -- В случае, если явно не указан - задается автоматически
    "ДАТА" varchar(10), 
    -- Так как в это поле заносятся только названия месяцев, 
    -- можно использовать varchar и не имеет смысла хранить эти данные в date
    "ПРОДАВЕЦ" integer,
    "ПОКУПАТЕЛЬ" integer,
    "КНИГА" integer,
    -- Данные поля по сути имеют связь с первичными ключами из таблиц выше, 
    -- поэтому и типы у них соответствующие
    "КОЛ-ВО" integer,
    -- Количество товаров в покупке может быть очень большим,
    -- в том числе больше 32767, поэтому smallint может не подойти
    "СУММА" integer,
    -- На всякий случай, используем integer, т.к. сумма может быть очень высокой
    PRIMARY KEY ("НОМЕР ЗАКАЗА")
    -- Первичный ключ
);
```
* CREATE TABLE
* CREATE TABLE
* CREATE TABLE
* CREATE TABLE



2. Ввести в ранее созданные таблицы конкретные данные (см. прил. 1). 
   Использовать скрипт-файл из операторов INSERT или вспомогательную утилиту.
   
```sql
INSERT INTO "ПОКУПАТЕЛЬ" VALUES 
(001, 'Cидоров', 'Нижегородский', 10),
(002, 'Потапов', 'Советский', 20),
(003, 'Попов', 'Ленинский', 10),
(004, 'Романова', 'Нижегородский', 10),
(005, 'Миронов', 'Автозаводский', 15),
(006, 'Попов', 'Советский', 0);

INSERT INTO "МАГАЗИН" VALUES 
(001, 'Знание',	'Автозаводский', 7),
(002, 'Наука',	'Нижегородский', 8),
(003, 'Книжный мир', 'Приокский', 6),
(004, 'Книги', 'Сормовский', 9),
(005, 'Книги', 'Советский', 7);

INSERT INTO "КНИГИ" VALUES 
(001, 'Windows для чайников', 15000, 'Сормовский', 400),
(002, 'Excel 5.0', 23000, 'Сормовский',	360),
(003, 'Работа с Visual FoxPro',	32000, 'Нижегородский',	300),
(004, 'Программирование в среде Delphi', 20000,	'Нижегородский', 100),
(005, 'SQL', 47000,	'Автозаводский', 89),
(006, 'Word 6.0 для Windows', 16000, 'Сормовский', 200),
(007, 'Твой первый выход в Internet', 15000, 'Советский', 140);

INSERT INTO "ПОКУПКА" VALUES 
(10011, 'Январь', 001, 006, 003, 2, 64000),
(10012,	'Январь', 001, 006, 002, 2, 46000),
(10013,	'Январь', 005, 005, 004, 4, 80000),
(10014,	'Февраль', 001, 003, 003, 3, 96000),
(10015,	'Февраль', 004,	006, 002, 1, 23000),
(10016,	'Март',	001, 004, 007, 2, 30000),
(10017,	'Март',	005, 006, 006, 3, 48000),
(10018,	'Апрель', 001, 001, 003, 3, 96000),
(10019,	'Апрель', 003, 003, 007, 2, 30000),
(10020,	'Апрель', 005, 002, 002, 5, 115000),
(10021,	'Апрель', 005, 002, 001, 3, 45000),
(10022,	'Май', 002, 003, 007, 2, 30000),
(10023,	'Май', 002, 004, 003, 1, 32000),
(10024,	'Май', 004, 003, 005, 1, 47000),
(10025,	'Май', 004, 006, 003, 4, 60000),
(10026,	'Май', 005, 001, 005, 3, 80000),
(10027,	'Июнь',	003, 002, 006, 2, 32000);
```

* INSERT 0 6
* INSERT 0 5
* INSERT 0 7
* INSERT 0 17

3. Используя оператор SELECT создать запрос для вывода всех строк каждой таблицы. Проверить правильность ввода. 
   При необходимости произвести коррекцию значений операторами INSERT, UPDATE, DELETE.
   
```sql
SELECT * FROM "ПОКУПАТЕЛЬ";
SELECT * FROM "МАГАЗИН";
SELECT * FROM "КНИГИ";
SELECT * FROM "ПОКУПКА";
```

| ИДЕНТИФИКАТОР | ФАМИЛИЯ  | РАЙОН ПРОЖИВАНИЯ | СКИДКА |
| --------------|----------|------------------|--------|
|             1 | Cидоров  | Нижегородский    |     10 |
|             2 | Потапов  | Советский        |     20 |
|             3 | Попов    | Ленинский        |     10 |
|             4 | Романова | Нижегородский    |     10 |
|             5 | Миронов  | Автозаводский    |     15 |
|             6 | Попов    | Советский        |      0 |

(6 rows)

| ИДЕНТИФИКАТОР |  НАЗВАНИЕ   | РАЙОН РАЗМЕЩЕНИЯ | КОМИССИОННЫЕ |
| --------------|-------------|------------------|------------- |
|             1 | Знание      | Автозаводский    |            7 |
|             2 | Наука       | Нижегородский    |            8 |
|             3 | Книжный мир | Приокский        |            6 |
|             4 | Книги       | Сормовский       |            9 |
|             5 | Книги       | Советский        |            7 |

(5 rows)

| ИДЕНТИФИКАТОР |            НАЗВАНИЕ             | СТОИМОСТЬ |     СКЛАД     | КОЛ-ВО | 
| --------------|---------------------------------|-----------|---------------|--------|
|             1 | Windows для чайников            |     15000 | Сормовский    |    400 |
|             2 | Excel 5.0                       |     23000 | Сормовский    |    360 |
|             3 | Работа с Visual FoxPro          |     32000 | Нижегородский |    300 |
|             4 | Программирование в среде Delphi |     20000 | Нижегородский |    100 |
|             5 | SQL                             |     47000 | Автозаводский |     89 |
|             6 | Word 6.0 для Windows            |     16000 | Сормовский    |    200 |
|             7 | Твой первый выход в Internet    |     15000 | Советский     |    140 |

(7 rows)

| НОМЕР ЗАКАЗА |  ДАТА   | ПРОДАВЕЦ | ПОКУПАТЕЛЬ | КНИГА | КОЛ-ВО | СУММА  
|--------------|---------|----------|------------|-------|--------|------
|        10011 | Январь  |        1 |          6 |     3 |      2 |  64000
|        10012 | Январь  |        1 |          6 |     2 |      2 |  46000
|        10013 | Январь  |        5 |          5 |     4 |      4 |  80000
|        10014 | Февраль |        1 |          3 |     3 |      3 |  96000
|        10015 | Февраль |        4 |          6 |     2 |      1 |  23000
|        10016 | Март    |        1 |          4 |     7 |      2 |  30000
|        10017 | Март    |        5 |          6 |     6 |      3 |  48000
|        10018 | Апрель  |        1 |          1 |     3 |      3 |  96000
|        10019 | Апрель  |        3 |          3 |     7 |      2 |  30000
|        10020 | Апрель  |        5 |          2 |     2 |      5 | 115000
|        10021 | Апрель  |        5 |          2 |     1 |      3 |  45000
|        10022 | Май     |        2 |          3 |     7 |      2 |  30000
|        10023 | Май     |        2 |          4 |     3 |      1 |  32000
|        10024 | Май     |        4 |          3 |     5 |      1 |  47000
|        10025 | Май     |        4 |          6 |     3 |      4 |  60000
|        10026 | Май     |        5 |          1 |     5 |      3 |  80000
|        10027 | Июнь    |        3 |          2 |     6 |      2 |  32000

(17 rows)


4. Создать запросы для вывода:
```sql
-- a) всех различных названий и стоимостей книг;
SELECT DISTINCT "НАЗВАНИЕ", "СТОИМОСТЬ" FROM "КНИГИ";
-- b) всех различных районов, в которых проживают покупатели;
SELECT DISTINCT "РАЙОН ПРОЖИВАНИЯ" FROM "ПОКУПАТЕЛЬ";
-- c) всех различных месяцев, когда производились покупки.
SELECT DISTINCT "ДАТА" FROM "ПОКУПКА"
```

|            НАЗВАНИЕ             | СТОИМОСТЬ 
|---------------------------------|----------
| Твой первый выход в Internet    |     15000
| Работа с Visual FoxPro          |     32000
| Программирование в среде Delphi |     20000
| Word 6.0 для Windows            |     16000
| Windows для чайников            |     15000
| SQL                             |     47000
| Excel 5.0                       |     23000

(7 rows)

| РАЙОН ПРОЖИВАНИЯ 
|-----------------
| Ленинский
| Нижегородский
| Автозаводский
| Советский

(4 rows)

|  ДАТА   
|--------
| Февраль
| Январь
| Апрель
| Март
| Май
| Июнь

(6 rows)

5. Создать запросы для получения инорфмации о:
```sql
-- a) фамилиях и размере скидки всех покупателей, 
-- проживающих в Нижегородском районе;
SELECT ФАМИЛИЯ, СКИДКА FROM ПОКУПАТЕЛЬ WHERE "РАЙОН ПРОЖИВАНИЯ" = 'Нижегородский';
-- b) названиях магазинов Сормовского или Советского районов;
SELECT НАЗВАНИЕ FROM МАГАЗИН WHERE "РАЙОН РАЗМЕЩЕНИЯ" = 'Сормовский' OR "РАЙОН РАЗМЕЩЕНИЯ" = 'Советский';
-- c) Названиях и стоимости книг, в которых встречается слово Windows, или стоящих более 20000 руб. 
-- Вывод результатов организовать по названию и убыванию цены книг.
SELECT НАЗВАНИЕ, СТОИМОСТЬ FROM КНИГИ WHERE "НАЗВАНИЕ" LIKE '%Windows%' OR "СТОИМОСТЬ" > 20000 
ORDER BY СТОИМОСТЬ DESC;
```

| ФАМИЛИЯ  | СКИДКА 
|----------|-------
| Cидоров  |     10
| Романова |     10

(2 rows)

| НАЗВАНИЕ 
|---------
| Книги
| Книги

(2 rows)

|        НАЗВАНИЕ        | СТОИМОСТЬ 
|------------------------|-----------
| SQL                    |     47000
| Работа с Visual FoxPro |     32000
| Excel 5.0              |     23000
| Word 6.0 для Windows   |     16000
| Windows для чайников   |     15000

(5 rows)



6. Для каждой покупки вывести следующие данные:
```sql
-- a) фамилию покупателя и название магазина, где производилась покупка;
SELECT ПОКУПКА."НОМЕР ЗАКАЗА", ПОКУПАТЕЛЬ.ФАМИЛИЯ, МАГАЗИН.НАЗВАНИЕ 
FROM ПОКУПКА, ПОКУПАТЕЛЬ, МАГАЗИН
WHERE ПОКУПАТЕЛЬ.ИДЕНТИФИКАТОР = ПОКУПКА.ПОКУПАТЕЛЬ 
AND МАГАЗИН.ИДЕНТИФИКАТОР = ПОКУПКА.ПРОДАВЕЦ;
```
| НОМЕР ЗАКАЗА | ФАМИЛИЯ  |  НАЗВАНИЕ   
|--------------|----------|------------
|        10011 | Попов    | Знание
|        10012 | Попов    | Знание
|        10013 | Миронов  | Книги
|        10014 | Попов    | Знание
|        10015 | Попов    | Книги
|        10016 | Романова | Знание
|        10017 | Попов    | Книги
|        10018 | Cидоров  | Знание
|        10019 | Попов    | Книжный мир
|        10020 | Потапов  | Книги
|        10021 | Потапов  | Книги
|        10022 | Попов    | Наука
|        10023 | Романова | Наука
|        10024 | Попов    | Книги
|        10025 | Попов    | Книги
|        10026 | Cидоров  | Книги
|        10027 | Потапов  | Книжный мир

(17 rows)

```sql
-- b) дату, фамилию покупателя, скидку, название 
-- и количество купленных книг.
SELECT ПОКУПКА.ДАТА, ПОКУПАТЕЛЬ.ФАМИЛИЯ, ПОКУПАТЕЛЬ.СКИДКА, 
КНИГИ.НАЗВАНИЕ, ПОКУПКА."КОЛ-ВО" FROM ПОКУПКА, ПОКУПАТЕЛЬ, КНИГИ
WHERE ПОКУПКА.ПОКУПАТЕЛЬ = ПОКУПАТЕЛЬ.ИДЕНТИФИКАТОР 
AND ПОКУПКА.КНИГА = КНИГИ.ИДЕНТИФИКАТОР;
```

|  ДАТА   | ФАМИЛИЯ  | СКИДКА |            НАЗВАНИЕ             | КОЛ-ВО 
|---------|----------|--------|---------------------------------|-------
| Январь  | Попов    |      0 | Работа с Visual FoxPro          |      2
| Январь  | Попов    |      0 | Excel 5.0                       |      2
| Январь  | Миронов  |     15 | Программирование в среде Delphi |      4
| Февраль | Попов    |     10 | Работа с Visual FoxPro          |      3
| Февраль | Попов    |      0 | Excel 5.0                       |      1
| Март    | Романова |     10 | Твой первый выход в Internet    |      2
| Март    | Попов    |      0 | Word 6.0 для Windows            |      3
| Апрель  | Cидоров  |     10 | Работа с Visual FoxPro          |      3
| Апрель  | Попов    |     10 | Твой первый выход в Internet    |      2
| Апрель  | Потапов  |     20 | Excel 5.0                       |      5
| Апрель  | Потапов  |     20 | Windows для чайников            |      3
| Май     | Попов    |     10 | Твой первый выход в Internet    |      2
| Май     | Романова |     10 | Работа с Visual FoxPro          |      1
| Май     | Попов    |     10 | SQL                             |      1
| Май     | Попов    |      0 | Работа с Visual FoxPro          |      4
| Май     | Cидоров  |     10 | SQL                             |      3
| Июнь    | Потапов  |     20 | Word 6.0 для Windows            |      2

(17 rows)


7. Определить:
```sql
-- a) номер заказа, фамилию покупателя и дату для покупок 
-- в которых было продано книг на сумму не меньшую чем 60000 руб.
SELECT ПОКУПКА."НОМЕР ЗАКАЗА", ПОКУПАТЕЛЬ.ФАМИЛИЯ, ПОКУПКА.ДАТА 
FROM ПОКУПКА, ПОКУПАТЕЛЬ WHERE ПОКУПКА.СУММА >= 60000 
AND ПОКУПАТЕЛЬ.ИДЕНТИФИКАТОР = ПОКУПКА.ПОКУПАТЕЛЬ;
```
| НОМЕР ЗАКАЗА | ФАМИЛИЯ |  ДАТА   
|--------------|---------|--------
|        10011 | Попов   | Январь
|        10013 | Миронов | Январь
|        10014 | Попов   | Февраль
|        10018 | Cидоров | Апрель
|        10020 | Потапов | Апрель
|        10025 | Попов   | Май
|        10026 | Cидоров | Май

(7 rows)

```sql
-- b) покупки, сделанные покупателем в своем районе не ранее марта месяца. 
-- Вывести фамилию покупателя, район, дату. Произвести сортировку;
SELECT DISTINCT ПОКУПКА."НОМЕР ЗАКАЗА", ПОКУПАТЕЛЬ.ФАМИЛИЯ, 
ПОКУПАТЕЛЬ."РАЙОН ПРОЖИВАНИЯ", ПОКУПКА.ДАТА 
FROM ПОКУПКА JOIN ПОКУПАТЕЛЬ ON ПОКУПКА.ПОКУПАТЕЛЬ = ПОКУПАТЕЛЬ.ИДЕНТИФИКАТОР
JOIN МАГАЗИН ON ПОКУПКА."ПРОДАВЕЦ" = МАГАЗИН."ИДЕНТИФИКАТОР"
WHERE ПОКУПКА.ДАТА NOT IN ('Январь', 'Февраль') 
AND ПОКУПАТЕЛЬ."РАЙОН ПРОЖИВАНИЯ" = МАГАЗИН."РАЙОН РАЗМЕЩЕНИЯ" 
ORDER BY ПОКУПКА."НОМЕР ЗАКАЗА";
```

| НОМЕР ЗАКАЗА | ФАМИЛИЯ  | РАЙОН ПРОЖИВАНИЯ |  ДАТА  
|--------------|----------|------------------|-------
|        10017 | Попов    | Советский        | Март
|        10020 | Потапов  | Советский        | Апрель
|        10021 | Потапов  | Советский        | Апрель
|        10023 | Романова | Нижегородский    | Май

(4 rows)


```sql
-- c) магазины, расположенные в любом районе, кроме Автозаводского, 
-- где покупали книги те, у кого скидка от 10 до 15 %;
SELECT DISTINCT МАГАЗИН.ИДЕНТИФИКАТОР FROM МАГАЗИН 
JOIN ПОКУПКА ON МАГАЗИН.ИДЕНТИФИКАТОР = ПОКУПКА.ПРОДАВЕЦ
JOIN ПОКУПАТЕЛЬ ON ПОКУПКА.ПОКУПАТЕЛЬ = ПОКУПАТЕЛЬ.ИДЕНТИФИКАТОР
WHERE (ПОКУПАТЕЛЬ.СКИДКА >= 10 AND ПОКУПАТЕЛЬ.СКИДКА <= 15) 
AND (МАГАЗИН."РАЙОН РАЗМЕЩЕНИЯ" != 'Автозаводский');
```

| ИДЕНТИФИКАТОР 
|--------------
|             2
|             3
|             4
|             5

(4 rows)

```sql
-- d) данные по покупке книг (название, район складирования, количество), 
-- приобретенных в районе складирования и содержащихся в запасе более 10 штук. 
-- Включить данные о стоимости и отсортировать по возрастанию.
SELECT КНИГИ.НАЗВАНИЕ, КНИГИ.СКЛАД, КНИГИ."КОЛ-ВО", КНИГИ."СТОИМОСТЬ" FROM КНИГИ
JOIN ПОКУПКА ON КНИГИ.ИДЕНТИФИКАТОР = ПОКУПКА.КНИГА
JOIN МАГАЗИН ON ПОКУПКА.ПРОДАВЕЦ = МАГАЗИН.ИДЕНТИФИКАТОР 
WHERE КНИГИ.СКЛАД = МАГАЗИН."РАЙОН РАЗМЕЩЕНИЯ" AND КНИГИ."КОЛ-ВО" >= 10 
ORDER BY КНИГИ.СТОИМОСТЬ;
```

|        НАЗВАНИЕ        |     СКЛАД     | КОЛ-ВО | СТОИМОСТЬ 
|------------------------|---------------|--------|---------
| Excel 5.0              | Сормовский    |    360 |     23000
| Работа с Visual FoxPro | Нижегородский |    300 |     32000

(2 rows)

8. Создать запрос для модификации всех значений столбца с суммарной величиной покупки, 
   чтобы он содержал истинную сумму, оплачиваемую покупателем (с учетом скидки). 
   Вывести новые значения.
   
```sql
UPDATE ПОКУПКА SET СУММА = СУММА - СУММА / 100*ПОКУПАТЕЛЬ.СКИДКА FROM ПОКУПАТЕЛЬ
WHERE ПОКУПКА.ПОКУПАТЕЛЬ = ПОКУПАТЕЛЬ.ИДЕНТИФИКАТОР;

SELECT * FROM ПОКУПКА;
```
| НОМЕР ЗАКАЗА |  ДАТА   | ПРОДАВЕЦ | ПОКУПАТЕЛЬ | КНИГА | КОЛ-ВО | СУММА 
|--------------|---------|----------|------------|-------|--------|-------
|        10011 | Январь  |        1 |          6 |     3 |      2 | 64000
|        10012 | Январь  |        1 |          6 |     2 |      2 | 46000
|        10013 | Январь  |        5 |          5 |     4 |      4 | 68000
|        10014 | Февраль |        1 |          3 |     3 |      3 | 86400
|        10015 | Февраль |        4 |          6 |     2 |      1 | 23000
|        10016 | Март    |        1 |          4 |     7 |      2 | 27000
|        10017 | Март    |        5 |          6 |     6 |      3 | 48000
|        10018 | Апрель  |        1 |          1 |     3 |      3 | 86400
|        10019 | Апрель  |        3 |          3 |     7 |      2 | 27000
|        10020 | Апрель  |        5 |          2 |     2 |      5 | 92000
|        10021 | Апрель  |        5 |          2 |     1 |      3 | 36000
|        10022 | Май     |        2 |          3 |     7 |      2 | 27000
|        10023 | Май     |        2 |          4 |     3 |      1 | 28800
|        10024 | Май     |        4 |          3 |     5 |      1 | 42300
|        10025 | Май     |        4 |          6 |     3 |      4 | 60000
|        10026 | Май     |        5 |          1 |     5 |      3 | 72000
|        10027 | Июнь    |        3 |          2 |     6 |      2 | 25600

(17 rows)

9. Расширить таблицу с данными о покупке столбцом, содержащим величину коммисионных, 
   получаемых магазином. Создать запрос для ввода конкретных значений 
   во все строки таблицы покупок.

```sql
ALTER TABLE ПОКУПКА ADD COLUMN КОММИСИОННЫЕ smallint;
UPDATE ПОКУПКА SET КОММИСИОННЫЕ = МАГАЗИН.КОМИСCИОННЫЕ FROM МАГАЗИН 
WHERE ПОКУПКА.ПРОДАВЕЦ = МАГАЗИН.ИДЕНТИФИКАТОР;

SELECT * FROM ПОКУПКА;
```

| НОМЕР ЗАКАЗА |  ДАТА   | ПРОДАВЕЦ | ПОКУПАТЕЛЬ | КНИГА | КОЛ-ВО | СУММА | КОММИСИОННЫЕ 
|--------------|---------|----------|------------|-------|--------|-------|--------------
|        10011 | Январь  |        1 |          6 |     3 |      2 | 64000 |            7
|        10012 | Январь  |        1 |          6 |     2 |      2 | 46000 |            7
|        10013 | Январь  |        5 |          5 |     4 |      4 | 68000 |            7
|        10014 | Февраль |        1 |          3 |     3 |      3 | 86400 |            7
|        10015 | Февраль |        4 |          6 |     2 |      1 | 23000 |            9
|        10016 | Март    |        1 |          4 |     7 |      2 | 27000 |            7
|        10017 | Март    |        5 |          6 |     6 |      3 | 48000 |            7
|        10018 | Апрель  |        1 |          1 |     3 |      3 | 86400 |            7
|        10019 | Апрель  |        3 |          3 |     7 |      2 | 27000 |            6
|        10020 | Апрель  |        5 |          2 |     2 |      5 | 92000 |            7
|        10021 | Апрель  |        5 |          2 |     1 |      3 | 36000 |            7
|        10022 | Май     |        2 |          3 |     7 |      2 | 27000 |            8
|        10023 | Май     |        2 |          4 |     3 |      1 | 28800 |            8
|        10024 | Май     |        4 |          3 |     5 |      1 | 42300 |            9
|        10025 | Май     |        4 |          6 |     3 |      4 | 60000 |            9
|        10026 | Май     |        5 |          1 |     5 |      3 | 72000 |            7
|        10027 | Июнь    |        3 |          2 |     6 |      2 | 25600 |            6

(17 rows)



10. Используя операцию IN (NOT IN) реализовать следующие запросы:
```sql
-- a) найти покупателей, которые не покупали книг в магазинах 
-- Нижегородского района в июне месяце;
SELECT DISTINCT ПОКУПАТЕЛЬ, ФАМИЛИЯ
FROM ПОКУПКА
JOIN ПОКУПАТЕЛЬ ON ПОКУПАТЕЛЬ.ИДЕНТИФИКАТОР = ПОКУПКА.ПОКУПАТЕЛЬ
JOIN МАГАЗИН ON МАГАЗИН.ИДЕНТИФИКАТОР = ПОКУПКА.ПРОДАВЕЦ
WHERE ДАТА NOT IN ('Июнь') AND "РАЙОН РАЗМЕЩЕНИЯ" NOT IN ('Нижегородский'); 
```
| ПОКУПАТЕЛЬ | ФАМИЛИЯ  
|------------|----------
|          1 | Cидоров
|          2 | Потапов
|          3 | Попов
|          4 | Романова
|          5 | Миронов
|          6 | Попов

(6 rows)

```sql
-- b) найти покупателей, покупавших книги в мае на сумму, 
-- меньшую чем купил Потапов в том же месяце;
SELECT ПОКУПАТЕЛЬ.ИДЕНТИФИКАТОР, ФАМИЛИЯ
FROM ПОКУПАТЕЛЬ
JOIN ПОКУПКА ON ПОКУПКА.ПОКУПАТЕЛЬ = ПОКУПАТЕЛЬ.ИДЕНТИФИКАТОР
JOIN МАГАЗИН ON МАГАЗИН.ИДЕНТИФИКАТОР = ПОКУПКА.ПРОДАВЕЦ
WHERE ДАТА IN ('Апрель')
GROUP BY ПОКУПАТЕЛЬ.ИДЕНТИФИКАТОР, ФАМИЛИЯ
HAVING SUM(СУММА) < (SELECT SUM(СУММА) FROM ПОКУПКА
JOIN ПОКУПАТЕЛЬ ON ПОКУПКА.ПОКУПАТЕЛЬ = ПОКУПАТЕЛЬ.ИДЕНТИФИКАТОР
WHERE ПОКУПАТЕЛЬ.ФАМИЛИЯ IN ('Потапов') AND ДАТА IN ('Апрель'));
```
| ИДЕНТИФИКАТОР | ФАМИЛИЯ 
|---------------|---------
|             1 | Cидоров
|             3 | Попов

(2 rows)

```sql
-- c) реализовать запросы заданий 7.а.
SELECT "НОМЕР ЗАКАЗА", ФАМИЛИЯ, ДАТА
FROM ПОКУПКА, ПОКУПАТЕЛЬ
WHERE СУММА >= 60000 AND ПОКУПАТЕЛЬ.ИДЕНТИФИКАТОР IN (ПОКУПКА.ПОКУПАТЕЛЬ); 
```

| НОМЕР ЗАКАЗА | ФАМИЛИЯ |  ДАТА   
|--------------|---------|---------
|        10026 | Cидоров | Май
|        10018 | Cидоров | Апрель
|        10020 | Потапов | Апрель
|        10014 | Попов   | Февраль
|        10013 | Миронов | Январь
|        10025 | Попов   | Май
|        10011 | Попов   | Январь

(7 rows)

```sql
-- c) реализовать запросы заданий 7.c.
SELECT DISTINCT МАГАЗИН.ИДЕНТИФИКАТОР, НАЗВАНИЕ
FROM МАГАЗИН
JOIN ПОКУПКА ON ПОКУПКА.ПРОДАВЕЦ = МАГАЗИН.ИДЕНТИФИКАТОР
JOIN ПОКУПАТЕЛЬ ON ПОКУПАТЕЛЬ.ИДЕНТИФИКАТОР = ПОКУПКА.ПОКУПАТЕЛЬ
WHERE "РАЙОН РАЗМЕЩЕНИЯ" NOT IN ('Автозаводский') AND ПОКУПКА.ПОКУПАТЕЛЬ IN (SELECT ИДЕНТИФИКАТОР
FROM ПОКУПАТЕЛЬ
WHERE СКИДКА BETWEEN 10 AND 15);
```
| ИДЕНТИФИКАТОР |  НАЗВАНИЕ   
|---------------|-------------
|             2 | Наука
|             3 | Книжный мир
|             4 | Книги
|             5 | Книги

(4 rows)


11. Используя операции ALL-ANY реализовать следующие запросы
```sql
-- a) определить покупателя, имеющего минимальную скидку среди тех, 
-- кто покупал книги на сумму не менее 50000руб
SELECT ПОКУПАТЕЛЬ.ФАМИЛИЯ FROM ПОКУПАТЕЛЬ 
WHERE ПОКУПАТЕЛЬ.СКИДКА <= ALL (SELECT ПОКУПАТЕЛЬ.СКИДКА 
FROM ПОКУПКА JOIN ПОКУПАТЕЛЬ ON ПОКУПАТЕЛЬ.ИДЕНТИФИКАТОР = ПОКУПКА.ПОКУПАТЕЛЬ 
WHERE ПОКУПКА.СУММА >= 50000)
```
| ФАМИЛИЯ 
|--------
| Попов

(1 row)

```sql
-- b) найти покупателя, покупавшего самое большое количество книг;
SELECT ПОКУПАТЕЛЬ.ФАМИЛИЯ FROM ПОКУПАТЕЛЬ
JOIN ПОКУПКА ON ПОКУПАТЕЛЬ.ИДЕНТИФИКАТОР = ПОКУПКА.ПОКУПАТЕЛЬ 
WHERE ПОКУПКА."КОЛ-ВО" >= ALL (SELECT "КОЛ-ВО" FROM ПОКУПКА)
```

| ФАМИЛИЯ 
|--------
| Потапов

(1 row)

```sql
-- c) запрос задания 7.b;
SELECT ПОКУПКА."НОМЕР ЗАКАЗА", ПОКУПАТЕЛЬ.ФАМИЛИЯ, ПОКУПАТЕЛЬ."РАЙОН ПРОЖИВАНИЯ", ПОКУПКА.ДАТА 
FROM ПОКУПКА
JOIN ПОКУПАТЕЛЬ ON ПОКУПАТЕЛЬ.ИДЕНТИФИКАТОР = ПОКУПКА.ПОКУПАТЕЛЬ
JOIN МАГАЗИН ON ПОКУПКА.ПРОДАВЕЦ = МАГАЗИН.ИДЕНТИФИКАТОР WHERE
ПОКУПАТЕЛЬ."РАЙОН ПРОЖИВАНИЯ" = МАГАЗИН."РАЙОН РАЗМЕЩЕНИЯ" AND 
ПОКУПКА.ДАТА <> ALL ('{Январь, Февраль}') ORDER BY ПОКУПКА."НОМЕР ЗАКАЗА"
```

| НОМЕР ЗАКАЗА | ФАМИЛИЯ  | РАЙОН ПРОЖИВАНИЯ |  ДАТА  
|--------------|----------|------------------|--------
|        10017 | Попов    | Советский        | Март
|        10020 | Потапов  | Советский        | Апрель
|        10021 | Потапов  | Советский        | Апрель
|        10023 | Романова | Нижегородский    | Май

(4 rows)


```sql
-- d) какой из покупателей не покупавший книг в магазинах своего района, 
-- делал покупки на минимальную сумму.
SELECT ПОКУПАТЕЛЬ.ФАМИЛИЯ, MIN(ПОКУПКА.СУММА) FROM ПОКУПКА, ПОКУПАТЕЛЬ
WHERE ПОКУПАТЕЛЬ.ФАМИЛИЯ IN (SELECT ФАМИЛИЯ FROM ПОКУПАТЕЛЬ 
WHERE ПОКУПАТЕЛЬ."РАЙОН ПРОЖИВАНИЯ" <> ALL (SELECT МАГАЗИН."РАЙОН РАЗМЕЩЕНИЯ"
FROM МАГАЗИН, ПОКУПКА WHERE ПОКУПАТЕЛЬ.ИДЕНТИФИКАТОР = ПОКУПКА.ПОКУПАТЕЛЬ))
GROUP BY ПОКУПАТЕЛЬ.ФАМИЛИЯ;
```

| ФАМИЛИЯ |  min  
|---------|-------
| Попов   | 23000

(1 row)


12. Используя операцию UNION получить районы проживания покупателей и 
    районы складирования книг.
    
```sql
SELECT "РАЙОН ПРОЖИВАНИЯ" AS "РАЙОНЫ ПРОЖИВАНИЯ ПОКУПАТЕЛЕЙ И СКЛАДОВ КНИГ"
FROM ПОКУПАТЕЛЬ
UNION
SELECT "СКЛАД"
FROM КНИГИ;
```

| РАЙОНЫ ПРОЖИВАНИЯ ПОКУПАТЕЛЕЙ И С 
|-----------------------------------
| Ленинский
| Нижегородский
| Сормовский
| Автозаводский
| Советский

(5 rows)




13. Используя операцию EXISTS ( NOT EXISTS ) реализовать нижеследующие запросы. 
    В случае, если для текущего состояния БД запрос будет выдавать пустое множество строк, 
    требуется указать какие добавления в БД необходимо провести.
    
```sql
-- a) какой покупатель покупал все книги в магазине “Наука” или “Знание”;
SELECT DISTINCT ПОКУПАТЕЛЬ FROM ПОКУПКА as ИДЕНТИФИКАТОР
WHERE EXISTS (SELECT * FROM ПОКУПКА WHERE ИДЕНТИФИКАТОР.ПОКУПАТЕЛЬ NOT IN 
(SELECT ПОКУПКА.ПОКУПАТЕЛЬ FROM ПОКУПКА
WHERE ПОКУПКА.ПРОДАВЕЦ != 1 AND ПРОДАВЕЦ != 2))
```

| ПОКУПАТЕЛЬ 
|------------
|          4

(1 row)

```sql
-- b) найти покупателей, покупавших книги во всех магазинах своего района до декабря;
SELECT ФАМИЛИЯ, ИДЕНТИФИКАТОР FROM ПОКУПАТЕЛЬ 
WHERE EXISTS(SELECT ПОКУПКА.ПОКУПАТЕЛЬ FROM ПОКУПКА, МАГАЗИН
WHERE ПОКУПАТЕЛЬ."РАЙОН ПРОЖИВАНИЯ" = МАГАЗИН."РАЙОН РАЗМЕЩЕНИЯ"
AND ПОКУПКА.ДАТА <> 'Декабрь');
```

| ФАМИЛИЯ  | ИДЕНТИФИКАТОР 
|----------|---------------
| Cидоров  |             1
| Потапов  |             2
| Романова |             4
| Миронов  |             5
| Попов    |             6

(5 rows)

```sql
-- c) определить покупателей, покупавших все книги, 
-- не продающиеся в магазине с максимальным значением комиссионных;
SELECT DISTINCT ПОКУПАТЕЛЬ FROM ПОКУПКА AS ИДЕНТИФИКАТОР
WHERE EXISTS(SELECT DISTINCT ПОКУПКА.ПОКУПАТЕЛЬ FROM ПОКУПКА
WHERE ИДЕНТИФИКАТОР.ПОКУПАТЕЛЬ NOT IN 
(SELECT ПОКУПКА.ПОКУПАТЕЛЬ FROM ПОКУПКА WHERE КОММИСИОННЫЕ = (
SELECT MAX(КОМИССИОННЫЕ) FROM МАГАЗИН)))
```

| ПОКУПАТЕЛЬ 
|------------
|          1
|          2
|          4
|          5

(4 rows)

```sql
-- d) найти среди покупателей тех, кто не покупал с мае книг со ценой более 25000руб. 
-- в магазинах с максимальным размером комиссионных.
SELECT ФАМИЛИЯ, ИДЕНТИФИКАТОР FROM ПОКУПАТЕЛЬ 
WHERE NOT EXISTS(SELECT ПОКУПАТЕЛЬ FROM ПОКУПКА
WHERE ПОКУПАТЕЛЬ.ИДЕНТИФИКАТОР = ПОКУПКА.ПОКУПАТЕЛЬ
AND ПОКУПКА.ДАТА = 'Май' AND ПОКУПКА.СУММА > 25000
AND ПОКУПКА.ПРОДАВЕЦ IN (SELECT МАГАЗИН.ИДЕНТИФИКАТОР
FROM МАГАЗИН WHERE КОММИСИОННЫЕ = (SELECT MAX(МАГАЗИН.КОМИССИОННЫЕ)
FROM МАГАЗИН)));
```

| ФАМИЛИЯ  | ИДЕНТИФИКАТОР 
|----------|---------------
| Cидоров  |             1
| Потапов  |             2
| Романова |             4
| Миронов  |             5

(4 rows)



14. Реализовать запросы с использованием аггрегатных функций:

```sql
-- a) получить среднюю стоимость покупок, сделанных в магазинах Нижегородского района;
SELECT AVG(СУММА)
FROM ПОКУПКА
WHERE ПРОДАВЕЦ = 
(SELECT ИДЕНТИФИКАТОР FROM МАГАЗИН WHERE "РАЙОН РАЗМЕЩЕНИЯ" = 'Нижегородский');
```

|        avg         
|--------------------
| 27900.000000000000

(1 row)

```sql
-- b) найти количество покупателей, покупавших книги в магазине “Наука”;
SELECT AVG(СУММА)
FROM ПОКУПКА
WHERE ПРОДАВЕЦ = 
(SELECT ИДЕНТИФИКАТОР FROM МАГАЗИН WHERE "РАЙОН РАЗМЕЩЕНИЯ" = 'Нижегородский');
```

|        avg         
|--------------------
| 27900.000000000000

(1 row)

```sql
-- c) найти покупателей имеющих скидку ниже средней;
SELECT ИДЕНТИФИКАТОР, ФАМИЛИЯ, "РАЙОН ПРОЖИВАНИЯ", СКИДКА
FROM ПОКУПАТЕЛЬ
WHERE СКИДКА < (SELECT AVG(СКИДКА) FROM ПОКУПАТЕЛЬ);
```

| ИДЕНТИФИКАТОР | ФАМИЛИЯ  | РАЙОН ПРОЖИВАНИЯ | СКИДКА 
|---------------|----------|------------------|--------
|             1 | Cидоров  | Нижегородский    |     10
|             3 | Попов    | Ленинский        |     10
|             4 | Романова | Нижегородский    |     10
|             6 | Попов    | Советский        |      0

(4 rows)

```sql
-- d) определить магазины, в которых покупало книги больше покупателей 
-- чем в магазине “Наука”.
SELECT ИДЕНТИФИКАТОР, НАЗВАНИЕ, "РАЙОН РАЗМЕЩЕНИЯ"
FROM МАГАЗИН
JOIN ПОКУПКА ON ПОКУПКА.ПРОДАВЕЦ = ИДЕНТИФИКАТОР
GROUP BY ИДЕНТИФИКАТОР, НАЗВАНИЕ, "РАЙОН РАЗМЕЩЕНИЯ"
HAVING COUNT(*) > (SELECT COUNT(*)
FROM ПОКУПКА
WHERE ПРОДАВЕЦ = (SELECT ИДЕНТИФИКАТОР
FROM МАГАЗИН WHERE НАЗВАНИЕ = 'Наука'));
```

| ИДЕНТИФИКАТОР | НАЗВАНИЕ | РАЙОН РАЗМЕЩЕНИЯ 
|---------------|----------|------------------
|             4 | Книги    | Сормовский
|             1 | Знание   | Автозаводский
|             5 | Книги    | Советский

(3 rows)

15. Используя средства группировки реализовать следующие запросы:

```sql
-- a) вывести данные по суммарной стоимости книг, купленных в каждом магазине;
SELECT МАГАЗИН.НАЗВАНИЕ, SUM(СУММА) AS СУММА
FROM ПОКУПКА
JOIN МАГАЗИН ON МАГАЗИН.ИДЕНТИФИКАТОР = ПОКУПКА.ПРОДАВЕЦ
GROUP BY ПРОДАВЕЦ, НАЗВАНИЕ;
```

|  НАЗВАНИЕ   | СУММА  
|-------------|--------
| Знание      | 309800
| Книги       | 316000
| Книжный мир |  52600
| Наука       |  55800
| Книги       | 125300

(5 rows)

```sql
-- b) вывести отчет о суммарной стоимости всех купленных книг по районам, 
-- где расположены магазины;
SELECT МАГАЗИН."РАЙОН РАЗМЕЩЕНИЯ", SUM(СУММА) AS СУММА
FROM ПОКУПКА
JOIN МАГАЗИН ON МАГАЗИН.ИДЕНТИФИКАТОР = ПОКУПКА.ПРОДАВЕЦ
GROUP BY ПРОДАВЕЦ, МАГАЗИН."РАЙОН РАЗМЕЩЕНИЯ";
```

| РАЙОН РАЗМЕЩЕНИЯ | СУММА  
|------------------|--------
| Автозаводский    | 309800
| Приокский        |  52600
| Нижегородский    |  55800
| Сормовский       | 125300
| Советский        | 316000

(5 rows)

```sql
-- c) получить сводную информацию о сумме всех покупок, произведенных каждым покупателем;
SELECT ПОКУПАТЕЛЬ."ФАМИЛИЯ", SUM(СУММА) AS СУММА
FROM ПОКУПКА
JOIN ПОКУПАТЕЛЬ ON ПОКУПАТЕЛЬ.ИДЕНТИФИКАТОР = ПОКУПКА.ПОКУПАТЕЛЬ
GROUP BY ПОКУПАТЕЛЬ.ИДЕНТИФИКАТОР, ПОКУПАТЕЛЬ."ФАМИЛИЯ";
```

| ФАМИЛИЯ  | СУММА  
|----------|--------
| Романова |  55800
| Попов    | 182700
| Cидоров  | 158400
| Миронов  |  68000
| Потапов  | 153600
| Попов    | 241000

(6 rows)

```sql
-- d) определить для каждого дня недели количество книг, 
-- купленных покупателями не из Советского района
SELECT ДАТА, SUM("КОЛ-ВО")
FROM ПОКУПКА
JOIN МАГАЗИН ON МАГАЗИН.ИДЕНТИФИКАТОР = ПОКУПКА.ПРОДАВЕЦ
WHERE ПОКУПАТЕЛЬ IN (SELECT ИДЕНТИФИКАТОР FROM ПОКУПАТЕЛЬ WHERE "РАЙОН ПРОЖИВАНИЯ" <> 'Советский')
GROUP BY ДАТА;
```

|  ДАТА   | sum 
|---------|-----
| Май     |   7
| Апрель  |   5
| Февраль |   3
| Январь  |   4
| Март    |   2

(5 rows)

